function hideSplash(){$.mobile.changePage("#homepage","fade")}var url="http://kevin.chalier.io/owesome_api/web/api",profileId="",currentTotal=0,transitioningSum=0,eventId="";$(function(){setTimeout(hideSplash,2e3)}),$("#homepage__login-form").on("submit",function(e){e.preventDefault();var n=$(this),i=n.serialize();$.ajax({type:"POST",data:i,url:url+"/users",dataType:"json",success:function(e){window.localStorage.setItem("profile_id",e.id.id),profileId=window.localStorage.getItem("profile_id"),$.mobile.navigate("#hub")}})}),$("#hub").on("click","#hub__content-events",function(e){e.preventDefault(),console.log(profileId),$.ajax({type:"GET",url:url+"/profiles/"+profileId,dataType:"json",success:function(e){console.log(e);var n=e[0].organizer;$("#my-events__content").empty(),$.each(n,function(i){$("#my-events__content").append('<div class="my-events__event" data-event-sum="'+n[i].total+'" data-event-id="'+e[0].organizer[i].id+'"><div class="event_info"><h1 class="event_name">'+e[0].organizer[i].name+'</h1><h2 class="event_date">'+new Date(e[0].organizer[i].date.date).toDateString()+"</h2></div></div>")}),$.mobile.navigate("#my-events",{transition:"slide"})}})}),$("#subscribe__sub-form").on("submit",function(e){e.preventDefault();var n=$(this),i=n.serialize();$.ajax({type:"POST",data:i,url:url+"/profiles",dataType:"json",success:function(e){$.mobile.navigate("#homepage")}})}),$("#new-event__create-form").on("submit",function(e){e.preventDefault();var n=$(this),i=n.find("#new-event__name").val(),t=n.find("#new-event__date").val();console.log(i,t);var s=n.serialize();$.ajax({type:"POST",data:s+"&organizer="+profileId,url:url+"/events",dataType:"json",success:function(e){$.ajax({type:"GET",url:url+"/profiles",dataType:"json",success:function(e){$.each(e,function(n){e[n].id!=profileId&&$("#invite__content").append('<div class="invite-profile" data-id="'+e[n].id+'"><p>'+e[n].user.username+"</p></div>")}),console.log(e)}}),$(".invite__event-details").append('<p class="event-details" data-event-id="'+e[1]+'">'+i+" "+t+"</p>"),$.mobile.navigate("#invite"),console.log(e)}})}),$("#invite").on("click",".invite-profile",function(e){e.preventDefault();var n=$(".event-details").data("event-id"),i=$(this).data("id");$(this).fadeOut(),$.ajax({type:"POST",url:url+"/transactions",data:"event="+n+"&profile="+i,dataType:"json",success:function(e){console.log(e)}})}),$("#invite__validate").on("click",function(e){e.preventDefault(),$.mobile.navigate("#hub")}),$("#my-events").on("click",".my-events__event",function(e){e.preventDefault();var n=$(this).data("event-id"),i=$(this).data("event-sum");$("#bill").find("#bill__text").data("event-id",n),"0"==i?$.mobile.navigate("#bill"):$.ajax({type:"GET",url:url+"/events/"+n,dataType:"json",success:function(e){var n=e[0].transactions;console.log(e),$("#closing__content").empty(),$.each(n,function(e){1==n[e].settled?$("#closing").find("#closing__content").append('<div class="closing-profile locked" data-transaction-id="'+n[e].id+'"><div class="settled" style="display: block"></div>'+n[e].profile.user.username+'<div class="owed-sum">'+n[e].sum+"</div></div>"):$("#closing").find("#closing__content").append('<div class="closing-profile" data-transaction-id="'+n[e].id+'"><div class="not-settled"></div><div class="settled"></div>'+n[e].profile.user.username+'<div class="owed-sum">'+n[e].sum+"</div></div>")}),$.mobile.navigate("#closing","slide")}})}),$("#bill__content-form").on("submit",function(e){e.preventDefault();var n=$(this),i=n.serialize(),t=$("#bill__text").data("event-id");currentTotal=parseInt($("#bill__montant").val()),eventId=t,$.ajax({type:"PUT",url:url+"/events/"+t,data:i+"&event="+t,dataType:"json",success:function(e){}}),$.ajax({type:"GET",url:url+"/events/"+t,dataType:"json",success:function(e){var n=e[0].transactions;$("#sharing__content").empty(),$(".sharing__event-details").empty(),$("#sharing").find(".sharing__event-details").append('<p class="event-details">'+e[0].name+"</p>"),$.each(n,function(e){$("#sharing").find("#sharing__content").append('<div class="sharing-profile" data-transaction-id="'+n[e].id+'"><div class="lockit"></div><div class="lockitlock"></div>'+n[e].profile.user.username+'<div class="plus-sum off"></div><div class="owed-sum">'+Math.ceil(currentTotal/n.length)+'</div><div class="minus-sum"></div></div>')}),$.mobile.navigate("#sharing")}})}),$("#sharing").on("click",".plus-sum",function(e){if($(this).hasClass("off"));else{e.preventDefault();var n=parseInt($(this).closest(".sharing-profile").find(".owed-sum").html());n+=1,transitioningSum-=1,$(this).closest(".sharing-profile").find(".owed-sum").html(n),0==transitioningSum&&$(".plus-sum").addClass("off"),n>0&&$(this).find(".sharing-profile").find(".minus-sum").removeClass("off"),console.log(n,transitioningSum)}}),$("#sharing").on("click",".minus-sum",function(e){if($(this).hasClass("off"));else{e.preventDefault();var n=parseInt($(this).closest(".sharing-profile").find(".owed-sum").html());n-=1,transitioningSum++,$(this).closest(".sharing-profile").find(".owed-sum").html(n),transitioningSum>0&&$(".plus-sum").removeClass("off"),0==n&&$(this).addClass("off"),console.log(n,transitioningSum)}}),$("#sharing").on("click",".lockit",function(e){e.preventDefault();var n=$(this).closest(".sharing-profile"),i=n.data("transaction-id"),t=parseInt(n.closest(".sharing-profile").find(".owed-sum").html());$.ajax({type:"PUT",url:url+"/transactions/"+i,data:"sum="+t+"&transaction="+i,dataType:"json",success:function(){n.find(".lockit").remove(),n.find(".lockitlock").css("display","block"),n.addClass("locked"),n.find(".plus-sum").remove(),n.find(".minus-sum").remove(),console.log("Transaction sum updated to "+t),""==$("#sharing").find(".lockit").length&&$("#sharing__validate").fadeIn()}})}),$("#sharing").on("click","#sharing__validate",function(e){e.preventDefault(),$.ajax({type:"GET",url:url+"/events/"+eventId,dataType:"json",success:function(e){var n=e[0].transactions;$("#closing").find("#closing__content").empty(),$.each(n,function(e){$("#closing").find("#closing__content").append('<div class="closing-profile" data-transaction-id="'+n[e].id+'"><div class="not-settled"></div><div class="settled"></div>'+n[e].profile.user.username+'<div class="owed-sum">'+n[e].sum+"</div></div>")}),$.mobile.navigate("#closing")}})}),$("#closing").on("click",".not-settled",function(e){e.preventDefault();var n=$(this).closest(".closing-profile"),i=n.data("transaction-id"),t=parseInt(n.find(".owed-sum").html());$.ajax({type:"PUT",url:url+"/transactions/"+i,data:"sum="+t+"&settled=1&transaction="+i,dataType:"json",success:function(){n.find(".not-settled").remove(),n.find(".settled").css("display","block"),n.addClass("locked"),""==$("#closing").find(".not-settled").length&&$("#closing__validate").fadeIn()}})}),$("#closing").on("click","#closing__validate",function(){$.mobile.navigate("#hub")});